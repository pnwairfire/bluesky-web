# General Information

## Request

The general request structure for each API listed below is the following:

      {
            "fires": [ ... ],
            "config": { ... },
            "modules": [ ... ]
        }

See [BlueSky Pipeline](https://github.com/pnwairfire/bluesky/blob/v2.7.2/README.md)
as well as the examples listed for each API, below, for more information
about required and optional post data.


## Response

In handling each requests for each API listed below, blueskyweb will run
bluesky in realtime, and the bluesky results will be in the API response.
The response data will be a modified version of the request fires data, minus
the "config" key, and with other keys added.  If 'verbose=true' is specifed
in the query string, then the reponse will be of the following structure:

    {
        "bluesky_version": "4.2.9",
        "counts": { ... }
        "fires": [ ... ],
        "processing": [ ... ],
        "run_config": { ... },
        "run_id": "<RUN_ID>",
        "runtime": { ... },
        "summary": { ... },
        "today": "2019-10-10",
        "version_info": { ... }
    }

where

 - "bluesky_version": specifies the vesion of bluesky used to generate the response
 - "counts" lists the number of fires in the run, as well as the total number of locations (specified_points and/or perimeters)
 - "fires" is the fire data augmented with module specified data
 - "processing" includes information (version info, etc.) about the modules that processed the data
 - "run_config" lists the config settings used for the run, including any specified under "config" in the request
 - "run_id" is the identifier used by bluesky for the run
 - "runtime" lists how long each module took to complete
 - "summary" contains summary data generated by the modules
 - "today" lists the day referenced by `{today}` wildcards in the configuration (if any are sued)
 - "version_info" lists the versions of bluesky modules as well as of third-part package dependencies

Otherwise, if 'verbose=true' is not specified, the response will
contain only 'fires', 'summary', 'run_id',  and 'bluesky_version'.




# APIs

## Fuelbeds

This API runs the bluesky through the fuelbeds module. It requires
posted JSON with two possible top level keys - 'fires' and 'config'.
The 'fires' key is required, and it lists the one or
more fires to process. The 'config' key is optional, and it
specifies configuration data and other control parameters.

### Request

 - url: $BLUESKY_API_ROOT_URL/api/v4.2/run/fuelbeds/
 - method: POST
 - post data: (see the General Information > Request section above, as well as the examples below)

### Examples

An example with fire location data specified as a geojson

    $ curl "$BLUESKY_API_ROOT_URL/api/v4.2/run/fuelbeds/" -H 'Content-Type: application/json' -d '{
        "fires": [
            {
                "id": "SF11C14225236095807750",
                "event_id": "SF11E826544",
                "name": "Natural Fire near Snoqualmie Pass, WA",
                "activity": [
                    {
                        "active_areas": [
                            {
                                "perimeter": {
                                    "geometry": {
                                        "type": "Polygon",
                                        "coordinates": [[
                                            [-121.4522115, 47.4316976],
                                            [-121.3990506, 47.4316976],
                                            [-121.3990506, 47.4099293],
                                            [-121.4522115, 47.4099293],
                                            [-121.4522115, 47.4316976]
                                        ]]
                                    }
                                },
                                "ecoregion": "southern",
                                "utc_offset": "-09:00"
                            }
                        ]
                    }
                ]
            }
        ]
    }' | python -m json.tool | less




## Emissions

This API runs bluesky through consumption and emissions. It supports
running fuelbeds before consumption, if specified under "modules".
It requires posted JSON with three possible top level keys -
'fires', and 'config', and 'modules'. The
'fires' key is required, and it lists the one or
more fires to process. The 'config' key is
optional, and it specifies configuration data and other control
parameters.  The 'modules' key is also optional, and is used to
specify a subset of the modules normally run by this API.

### Request

 - url: $BLUESKY_API_ROOT_URL/api/v4.2/run/emissions/
 - method: POST
 - post data: (see the General Information > Request section above, as well as the examples below)

### Examples

An example with fire location data specified as geojson

    $ echo '{
        "fires": [
            {
                "id": "SF11C14225236095807750",
                "event_id": "SF11E826544",
                "name": "Natural Fire near Snoqualmie Pass, WA",
                "activity": [
                    {
                        "active_areas": [
                            {
                                "start": "2019-08-24T17:00:00",
                                "end": "2010-08-25T17:00:00",
                                "perimeter": {
                                    "geometry": {
                                        "type": "Polygon",
                                        "coordinates": [[
                                            [-121.4522115, 47.4316976],
                                            [-121.3990506, 47.4316976],
                                            [-121.3990506, 47.4099293],
                                            [-121.4522115, 47.4099293],
                                            [-121.4522115, 47.4316976]
                                        ]]
                                    },
                                    "area": 200,
                                    "fuelbeds": [
                                        {
                                            "fccs_id": "9",
                                            "pct": 100.0
                                        }
                                    ]
                                },
                                "ecoregion": "southern",
                                "utc_offset": "-09:00"
                            }
                        ]
                    }
                ]
            }
        ]
    }' > dev/data/emissions-input.json

    $ curl "$BLUESKY_API_ROOT_URL/api/v4.2/run/emissions/" \
        -H 'Content-Type: application/json' \
        -d @dev/data/emissions-input.json | python -m json.tool | less


Another exmaple, this time running only the consumption
modules, and with fire location data specified as lat + lng + size.

    $ echo '{
        "modules": ["consumption"],
        "fires": [
            {
                "id": "SF11C14225236095807750",
                "event_of": {
                    "id": "SF11E826544",
                    "name": "Natural Fire near Snoqualmie Pass, WA"
                },
                "activity": [
                    {
                        "active_areas": [
                            {
                                "start": "2019-08-24T17:00:00",
                                "end": "2010-08-25T17:00:00",
                                "specified_points": [
                                    {
                                        "lat": 47.4316976,
                                        "lng": -121.3990506,
                                        "area": 200,
                                        "fuelbeds": [
                                            {
                                                "fccs_id": "9",
                                                "pct": 100.0
                                            }
                                        ]
                                    }
                                ],
                                "utc_offset": "-09:00",
                                "ecoregion": "southern"
                            }
                        ]
                    }
                ]
            }
        ]
    }' > dev/data/consumption-input.json

    $ curl "$BLUESKY_API_ROOT_URL/api/v4.2/run/emissions/" \
        -H 'Content-Type: application/json' \
        -d @dev/data/consumption-input.json | python -m json.tool | less


A third exmaple, this time running including the fuelbeds module along with
consumption and emission, and with fire location data specified as
lat + lng + size.

    $ echo '{
        "modules": ["fuelbeds", "consumption", "emissions"],
        "fires": [
            {
                "id": "SF11C14225236095807750",
                "event_of": {
                    "id": "SF11E826544",
                    "name": "Natural Fire near Snoqualmie Pass, WA"
                },
                "activity": [
                    {
                        "active_areas": [
                            {
                                "start": "2019-08-24T17:00:00",
                                "end": "2010-08-25T17:00:00",
                                "specified_points": [
                                    {
                                        "lat": 47.4316976,
                                        "lng": -121.3990506,
                                        "area": 200
                                    }
                                ],
                                "utc_offset": "-09:00",
                                "ecoregion": "southern"
                            }
                        ]
                    }
                ]
            }
        ]
    }' > dev/data/fuelbeds-through-emissions-input.json

    $ curl "$BLUESKY_API_ROOT_URL/api/v4.2/run/emissions/" \
        -H 'Content-Type: application/json' \
        -d @dev/data/fuelbeds-through-emissions-input.json | python -m json.tool | less
